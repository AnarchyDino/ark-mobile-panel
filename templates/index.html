<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ARK OPS: FIXED</title>
    <style>
        body { background:#111; color:#fff; font-family:sans-serif; padding:15px; }
        .btn { width:100%; padding:20px; margin-bottom:10px; font-weight:bold; font-size:1.2rem; cursor:pointer; }
        .btn-green { background:#0f0; color:#000; }
        .btn-red { background:#f00; color:#fff; }
        .btn-blue { background:#00f; color:#fff; }
        select, input { width:100%; padding:15px; margin-bottom:10px; font-size:1rem; }
        #console { background:#000; padding:10px; border:1px solid #555; height:150px; overflow-y:auto; font-family:monospace; color:#0f0; }
    </style>
</head>
<body>

    <h1>1. DIAGNOSTIC TEST</h1>
    <div id="console">Waiting...</div>
    <button class="btn btn-blue" onclick="send('Broadcast CONNECTION_TEST_SUCCESSFUL')">üì¢ TEST BROADCAST</button>
    <p style="font-size:0.8rem; color:#aaa">Click above. If you do not see red text at the top of your screen in-game, your RCON PORT in Render is wrong.</p>

    <h1>2. WORLD CONTROL</h1>
    <button class="btn" onclick="send('SetTimeOfDay 08:00')">‚òÄÔ∏è SET MORNING</button>
    <button class="btn" onclick="send('SetTimeOfDay 20:00')">üåô SET NIGHT</button>
    <button class="btn" onclick="send('SaveWorld')">üíæ FORCE SAVE</button>

    <h1>3. PLAYER KITS</h1>
    <button class="btn btn-blue" onclick="scan()">üîÑ SCAN PLAYERS</button>
    <select id="playerSelect"><option value="">Scan First...</option></select>
    
    <button class="btn btn-green" onclick="giveKit('pvp')">‚öîÔ∏è GIVE PVP KIT</button>
    <button class="btn btn-green" onclick="giveKit('tek')">ü§ñ GIVE TEK KIT</button>

    <script>
        let targetID = null;

        async function send(cmd) {
            // FORCE "cheat" PREFIX ON EVERYTHING
            const finalCmd = `cheat ${cmd}`;
            
            log(`> ${finalCmd}`);
            try {
                const res = await fetch('/api/command', {
                    method:'POST', headers:{'Content-Type':'application/json'},
                    body:JSON.stringify({command:finalCmd})
                });
                const data = await res.json();
                
                if(data.response.includes("‚ùå")) {
                    log(data.response);
                    alert("ERROR: " + data.response);
                } else {
                    log(`< ${data.response}`);
                }
            } catch(e) {
                log("‚ùå NETWORK ERROR");
            }
        }

        function log(m) { 
            const c=document.getElementById('console'); 
            c.innerHTML = `<div>${m}</div>` + c.innerHTML; 
        }

        async function scan() {
            // ListPlayers does NOT use 'cheat'
            const res = await fetch('/api/command', {
                method:'POST', headers:{'Content-Type':'application/json'},
                body:JSON.stringify({command:"ListPlayers"})
            });
            const data = await res.json();
            const list = document.getElementById('playerSelect');
            list.innerHTML = "";
            
            const matches = data.response.matchAll(/(\d+)\.\s(.*?),\s([0-9a-fA-F]+)/g);
            for(const m of matches) {
                const opt = document.createElement('option');
                opt.text = m[2]; 
                opt.value = m[3];
                list.add(opt);
            }
            log("‚úÖ Players Scanned");
            list.onchange = function(){ targetID = this.value; };
        }

        async function giveKit(type) {
            if(!targetID) return alert("Select a player!");
            
            const items = [];
            if(type === 'pvp') {
                items.push("Blueprint'/Game/PrimalEarth/CoreBlueprints/Weapons/PrimalItem_WeaponMachinedSniper.PrimalItem_WeaponMachinedSniper'");
                items.push("Blueprint'/Game/PrimalEarth/CoreBlueprints/Weapons/PrimalItemAmmo_AdvancedSniperBullet.PrimalItemAmmo_AdvancedSniperBullet'");
                items.push("Blueprint'/Game/PrimalEarth/CoreBlueprints/Items/Armor/Metal/PrimalItemArmor_MetalHelmet.PrimalItemArmor_MetalHelmet'");
                items.push("Blueprint'/Game/PrimalEarth/CoreBlueprints/Items/Armor/Metal/PrimalItemArmor_MetalShirt.PrimalItemArmor_MetalShirt'");
            }
            if(type === 'tek') {
                items.push("Blueprint'/Game/PrimalEarth/CoreBlueprints/Weapons/PrimalItem_TekRifle.PrimalItem_TekRifle'");
                items.push("Blueprint'/Game/PrimalEarth/CoreBlueprints/Items/Armor/Tek/PrimalItemArmor_TekHelmet.PrimalItemArmor_TekHelmet'");
                items.push("Blueprint'/Game/PrimalEarth/CoreBlueprints/Items/Armor/Tek/PrimalItemArmor_TekShirt.PrimalItemArmor_TekShirt'");
                items.push("Blueprint'/Game/PrimalEarth/CoreBlueprints/Resources/PrimalItemResource_Element.PrimalItemResource_Element'");
            }

            for(const bp of items) {
                // FORCE ITEM MODE: 1 quantity, 50 quality, 0 (Item, not BP)
                await send(`GiveItemToPlayer ${targetID} "${bp}" 1 50 0`);
            }
            alert("Kit Sent!");
        }
    </script>
</body>
</html>
