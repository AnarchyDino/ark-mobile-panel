<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARK OPS: UNIVERSAL</title>
    <style>
        :root { --bg:#050505; --panel:#111; --accent:#00ff9d; --danger:#ff0055; --text:#eee; }
        body { background:var(--bg); color:var(--text); font-family:sans-serif; margin:0; padding-bottom:90px; }
        
        .header { background:var(--panel); border-bottom:2px solid var(--accent); padding:15px; position:sticky; top:0; z-index:100; display:flex; justify-content:space-between; align-items:center; }
        h1 { margin:0; color:var(--accent); font-size:1.2rem; }
        .status { font-size:0.7rem; font-weight:bold; color:#666; }
        .status.on { color:var(--accent); text-shadow:0 0 5px var(--accent); }

        .view { display:none; padding:15px; }
        .view.active { display:block; }
        .card { background:var(--panel); border:1px solid #333; border-radius:6px; padding:15px; margin-bottom:15px; }
        
        .btn { width:100%; padding:14px; border:none; background:#222; color:#ccc; font-weight:bold; border-radius:4px; margin-bottom:5px; cursor:pointer; }
        .btn:active { background:#444; }
        .btn-main { background:var(--accent); color:black; }
        .btn-danger { background:var(--danger); color:white; }
        
        input, select { width:100%; padding:12px; background:#000; border:1px solid #444; color:white; margin-bottom:10px; border-radius:4px; font-size:1rem; box-sizing: border-box; }
        #console { background:#000; height:120px; overflow-y:auto; padding:10px; font-family:monospace; font-size:0.75rem; border:1px solid #333; color:#0f0; }

        .nav { position:fixed; bottom:0; width:100%; background:#080808; border-top:1px solid #333; display:flex; height:70px; z-index:90; }
        .nav-btn { flex:1; background:none; border:none; color:#444; font-size:1.5rem; }
        .nav-btn.active { color:var(--accent); }
    </style>
</head>
<body>

    <div class="header">
        <h1>ARK OPS</h1>
        <div id="status" class="status">DISCONNECTED</div>
    </div>

    <div style="padding:10px; background:#222; text-align:center;">
        <label style="font-weight:bold; display:flex; align-items:center; justify-content:center; gap:10px;">
            <input type="checkbox" id="useCheat" style="width:20px; height:20px; margin:0;"> 
            FORCE 'CHEAT' PREFIX
        </label>
        <div style="font-size:0.7rem; color:#aaa; margin-top:5px;">Check this if commands do nothing.</div>
    </div>

    <div id="view-manual" class="view active">
        <div class="card">
            <h2>Manual Command</h2>
            <p style="font-size:0.8rem; color:#aaa">Type any command here (e.g. "Fly", "Ghost", "GMSummon..."). No need to redeploy the site!</p>
            <input type="text" id="manualInput" placeholder="Type command here...">
            <button class="btn btn-main" onclick="sendCustom()">SEND COMMAND</button>
        </div>

        <div class="card">
            <h2>Console</h2>
            <div id="console">System Ready.</div>
        </div>
    </div>

    <div id="view-players" class="view">
        <div class="card">
            <button class="btn btn-main" onclick="scanPlayers()">üîÑ Scan Players</button>
            <div id="p-list" style="margin-top:10px;"></div>
        </div>
        
        <div id="p-actions" class="card" style="display:none;">
            <h2 id="target-name">Target: None</h2>
            <button class="btn btn-main" onclick="pCmd('heal')">‚ù§Ô∏è Heal</button>
            <button class="btn btn-danger" onclick="pCmd('kill')">üíÄ Kill</button>
            
            <h3>Give Kits</h3>
            <button class="btn" onclick="giveKit('pvp')">‚öîÔ∏è PvP Kit</button>
            <button class="btn" onclick="giveKit('tek')">ü§ñ Tek Kit</button>
            <button class="btn" onclick="giveKit('ammo')">üî´ Ammo Box</button>
        </div>
    </div>

    <div class="nav">
        <button class="nav-btn active" onclick="tab('manual',this)">‚å®Ô∏è</button>
        <button class="nav-btn" onclick="tab('players',this)">üë§</button>
    </div>

<script>
    let targetID = null;

    async function send(cmd) {
        const useCheat = document.getElementById('useCheat').checked;
        // Don't double add cheat if the user typed it manually
        let finalCmd = cmd;
        if(useCheat && !cmd.toLowerCase().startsWith("cheat ")) {
            finalCmd = `cheat ${cmd}`;
        }
        
        log(`> ${finalCmd}`);
        try {
            const res = await fetch('/api/command', {
                method:'POST', headers:{'Content-Type':'application/json'},
                body:JSON.stringify({command:finalCmd})
            });
            const data = await res.json();
            
            if(data.response.includes("‚ùå")) {
                log(data.response);
                document.getElementById('status').innerText = "ERROR";
                document.getElementById('status').style.color = "red";
            } else {
                log(`< ${data.response}`);
                document.getElementById('status').innerText = "ONLINE";
                document.getElementById('status').classList.add('on');
            }
        } catch(e) {
            log("‚ùå APP ERROR");
        }
    }

    function sendCustom() {
        const txt = document.getElementById('manualInput').value;
        if(txt) send(txt);
    }

    function log(m) { const c=document.getElementById('console'); c.innerHTML+=`<div>${m}</div>`; c.scrollTop=c.scrollHeight; }

    async function scanPlayers() {
        const res = await fetch('/api/command', {
            method:'POST', headers:{'Content-Type':'application/json'},
            body:JSON.stringify({command:"ListPlayers"})
        });
        const data = await res.json();
        const list = document.getElementById('p-list');
        
        list.innerHTML = "";
        const matches = data.response.matchAll(/(\d+)\.\s(.*?),\s([0-9a-fA-F]+)/g);
        let found = false;
        for(const m of matches) {
            found = true;
            const name = m[2]; const id = m[3];
            const div = document.createElement('div');
            div.style.background='#222'; div.style.padding='10px'; div.style.marginBottom='5px'; div.style.display='flex'; div.style.justifyContent='space-between';
            div.innerHTML = `<span><b>${name}</b></span> <button style="background:var(--accent); border:none; padding:5px 10px; cursor:pointer;" onclick="sel('${id}','${name}')">SELECT</button>`;
            list.appendChild(div);
        }
        if(found) { document.getElementById('status').innerText = "ONLINE"; }
        else { list.innerHTML = "<div style='text-align:center; color:#555;'>No Players</div>"; }
    }

    function sel(id, name) {
        targetID = id;
        document.getElementById('target-name').innerText = `Target: ${name}`;
        document.getElementById('p-actions').style.display = 'block';
        tab('manual', document.querySelectorAll('.nav-btn')[0]); // Switch to manual tab for visibility
        document.getElementById('manualInput').placeholder = `Command for ${name}...`;
    }

    function pCmd(type) {
        if(!targetID) return alert("Select Player First");
        if(type==='heal') send(`ScriptCommand RefillStats ${targetID}`);
        if(type==='kill') send(`KillPlayer ${targetID}`);
    }

    async function giveKit(k) {
        if(!targetID) return alert("Select Player");
        alert(`Sending ${k}...`);
        
        const ITEMS = {
            'pvp': [
                "Blueprint'/Game/PrimalEarth/CoreBlueprints/Weapons/PrimalItem_WeaponMachinedSniper.PrimalItem_WeaponMachinedSniper'",
                "Blueprint'/Game/PrimalEarth/CoreBlueprints/Weapons/PrimalItemAmmo_AdvancedSniperBullet.PrimalItemAmmo_AdvancedSniperBullet'",
                "Blueprint'/Game/PrimalEarth/CoreBlueprints/Items/Armor/Metal/PrimalItemArmor_MetalHelmet.PrimalItemArmor_MetalHelmet'",
                "Blueprint'/Game/PrimalEarth/CoreBlueprints/Items/Armor/Metal/PrimalItemArmor_MetalShirt.PrimalItemArmor_MetalShirt'"
            ],
            'tek': [
                "Blueprint'/Game/PrimalEarth/CoreBlueprints/Weapons/PrimalItem_TekRifle.PrimalItem_TekRifle'",
                "Blueprint'/Game/PrimalEarth/CoreBlueprints/Items/Armor/Tek/PrimalItemArmor_TekHelmet.PrimalItemArmor_TekHelmet'",
                "Blueprint'/Game/PrimalEarth/CoreBlueprints/Resources/PrimalItemResource_Element.PrimalItemResource_Element'"
            ],
            'ammo': [
                 "Blueprint'/Game/PrimalEarth/CoreBlueprints/Weapons/PrimalItemAmmo_AdvancedSniperBullet.PrimalItemAmmo_AdvancedSniperBullet'",
                 "Blueprint'/Game/PrimalEarth/CoreBlueprints/Weapons/PrimalItemAmmo_SimpleShotgunBullet.PrimalItemAmmo_SimpleShotgunBullet'"
            ]
        };
        
        for(const bp of ITEMS[k]) {
            await send(`GiveItemToPlayer ${targetID} "${bp}" 100 50 0`);
        }
    }

    function tab(v,b) {
        document.querySelectorAll('.view').forEach(x=>x.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(x=>x.classList.remove('active'));
        document.getElementById('view-'+v).classList.add('active');
        b.classList.add('active');
    }
</script>
</body>
</html>
